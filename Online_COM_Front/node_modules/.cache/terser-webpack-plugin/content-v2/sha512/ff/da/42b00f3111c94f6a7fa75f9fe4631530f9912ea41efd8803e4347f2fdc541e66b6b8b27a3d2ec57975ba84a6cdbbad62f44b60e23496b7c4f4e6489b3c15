{"code":"(wx[\"webpackJsonp\"]=wx[\"webpackJsonp\"]||[]).push([[39],{122:function(e,t,s){\"use strict\";s.r(t);var a=s(4),r=s(6),n=s(7),i=s(9),o=s(10),c=s(3),d=s.n(c),u=s(1),l=s(0),h=(s(86),s(2)),j=d.a.getApp(),m=Math.random().toFixed(6).slice(-6),p=function(e){Object(i[\"a\"])(s,e);var t=Object(o[\"a\"])(s);function s(e){var a;return Object(r[\"a\"])(this,s),a=t.call(this,e),a.state={uid:0,name:\"\",password:\"\",address:\"\",loading:!1,time:60,uidError:0,addressError:0,passwordError:0,codeError:0},a}return Object(n[\"a\"])(s,[{key:\"componentDidMount\",value:function(){}},{key:\"componentWillReceiveProps\",value:function(e){console.log(this.props,e)}},{key:\"componentWillUnmount\",value:function(){}},{key:\"componentDidShow\",value:function(){}},{key:\"componentDidHide\",value:function(){}},{key:\"handOnStudentID\",value:function(e){var t=this,s=/^\\d{10}$/;if(!s.test(e.detail.value))return this.setState({uidError:1}),!1;this.setState({uidError:0}),d.a.request({url:j.config.api+\"/users/unique\",method:\"GET\",data:{uid:e.detail.value},success:function(e){0!==e.data.length?t.setState({uidError:2}):t.setState({addressError:0})}}),this.setState({uid:e.detail.value})}},{key:\"handOnName\",value:function(e){this.setState({name:e.detail.value})}},{key:\"handOnPassword\",value:function(e){this.setState({password:e.detail.value})}},{key:\"handOnAddress\",value:function(e){var t=this,s=/^([\\S]*)+\\@(mails.tsinghua.edu.cn)$/;if(!s.test(e.detail.value))return this.setState({addressError:4}),!1;this.setState({addressError:0}),d.a.request({url:j.config.api+\"/users/unique\",method:\"GET\",data:{address:e.detail.value},success:function(e){0!==e.data.length?t.setState({addressError:5}):t.setState({addressError:0})}}),this.setState({address:e.detail.value})}},{key:\"sendCode\",value:function(){var e=this;if(this.state.uidError+this.state.addressError+this.state.passwordError!==0||\"\"===this.state.name||\"\"===this.state.password)return d.a.showToast({title:\"\\u8f93\\u5165\\u9519\\u8bef\",icon:\"error\",duration:2e3}),!1;this.setState({loading:!0}),setInterval((function(){m=Math.random().toFixed(6).slice(-6)}),3e5),d.a.request({url:j.config.api+\"/users/sendEmail\",method:\"POST\",data:{code:m,email:this.state.address}});var t=this.state.time,s=setInterval((function(){e.setState({time:t--},(function(){t<=-1&&(clearInterval(s),e.setState({loading:!1,time:59}))}))}),1e3)}},{key:\"handOnAuthCode\",value:function(e){e.detail.value===m?this.setState({codeError:0}):this.setState({codeError:6})}},{key:\"inputError\",value:function(e){switch(e){case 1:return\"\\u5b66\\u53f7\\u8f93\\u5165\\u9519\\u8bef\";case 2:return\"\\u5b66\\u53f7\\u5df2\\u88ab\\u6ce8\\u518c\";case 3:return\"\\u8f93\\u5165\\u5bc6\\u7801\\u4e0d\\u4e00\\u81f4\";case 4:return\"\\u90ae\\u7bb1\\u683c\\u5f0f\\u6709\\u8bef\";case 5:return\"\\u90ae\\u7bb1\\u5df2\\u88ab\\u6ce8\\u518c\";case 6:return\"\\u9a8c\\u8bc1\\u7801\\u8f93\\u5165\\u9519\\u8bef\"}}},{key:\"handOnUserInfo\",value:function(){if(this.state.uidError+this.state.addressError+this.state.passwordError+this.state.codeError!==0||\"\"===this.state.name||\"\"===this.state.password)return d.a.showToast({title:\"\\u8f93\\u5165\\u9519\\u8bef\",icon:\"error\",duration:2e3}),!1;d.a.request({url:j.config.api+\"/users/addInfo\",method:\"POST\",data:{uid:this.state.uid,name:this.state.name,password:this.state.password,email:this.state.address},success:function(e){console.log(e.data.message),d.a.setStorageSync(\"USER\",e.data.data.token),d.a.setStorageSync(\"UID\",e.data.data.uid),d.a.setStorageSync(\"NICKNAME\",e.data.data.nickname),d.a.setStorageSync(\"LEVEL\",1),d.a.showToast({title:\"\\u6ce8\\u518c\\u6210\\u529f\",icon:\"success\",duration:2e3}),d.a.switchTab({url:\"../index/index\"})}})}},{key:\"render\",value:function(){var e=this;return Object(h[\"jsxs\"])(l[\"s\"],{className:\"container\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u6ce8\\u518c\\u4fe1\\u606f\"}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"regist-box\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u5b66\\u53f7:\"}),Object(h[\"jsx\"])(l[\"s\"],{className:\"input\",children:Object(h[\"jsx\"])(l[\"f\"],{placeholder:\"\\u5b66\\u53f7\",onBlur:function(t){return e.handOnStudentID(t)}})}),Object(h[\"jsx\"])(l[\"s\"],{className:[\"message\",1===this.state.uidError||2===this.state.uidError?\"\":\"correct\"].join(\",\"),children:this.inputError(this.state.uidError)})]}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"regist-box\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u59d3\\u540d:\"}),Object(h[\"jsx\"])(l[\"s\"],{className:\"input\",children:Object(h[\"jsx\"])(l[\"f\"],{placeholder:\"\\u771f\\u5b9e\\u59d3\\u540d\",onBlur:function(t){return e.handOnName(t)}})})]}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"regist-box\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u5bc6\\u7801:\"}),Object(h[\"jsx\"])(l[\"s\"],{className:\"input\",children:Object(h[\"jsx\"])(l[\"f\"],{placeholder:\"\\u5bc6\\u7801\",password:!0,onBlur:function(t){return e.handOnPassword(t)}})})]}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"regist-box\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u786e\\u8ba4\\u5bc6\\u7801:\"}),Object(h[\"jsx\"])(l[\"s\"],{className:\"input\",children:Object(h[\"jsx\"])(l[\"f\"],{placeholder:\"\\u786e\\u8ba4\\u5bc6\\u7801\",password:!0,onBlur:function(t){t.detail.value!==e.state.password?e.setState({passwordError:3}):e.setState({passwordError:0})}})}),Object(h[\"jsx\"])(l[\"s\"],{className:[\"message\",3===this.state.passwordError?\"\":\"correct\"].join(\",\"),children:this.inputError(this.state.passwordError)})]}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"regist-box\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u90ae\\u7bb1:\"}),Object(h[\"jsx\"])(l[\"s\"],{className:\"input\",children:Object(h[\"jsx\"])(l[\"f\"],{placeholder:\"XXX@mails.tsinghua.edu.cn\",onBlur:function(t){return e.handOnAddress(t)}})}),Object(h[\"jsx\"])(l[\"s\"],{className:[\"message\",4===this.state.addressError||5===this.state.addressError?\"\":\"correct\"].join(\",\"),children:this.inputError(this.state.addressError)})]}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"regist-box\",children:[Object(h[\"jsx\"])(l[\"q\"],{children:\"\\u9a8c\\u8bc1\\u7801:\"}),Object(h[\"jsxs\"])(l[\"s\"],{className:\"code\",children:[Object(h[\"jsx\"])(l[\"s\"],{className:\"code-input\",children:Object(h[\"jsx\"])(l[\"f\"],{onBlur:function(t){return e.handOnAuthCode(t)}})}),Object(h[\"jsx\"])(l[\"s\"],{className:[\"update-phone-code\",this.state.loading?\"onloading\":\"\"].join(\",\"),onClick:function(){return e.sendCode()},children:this.state.loading?\"\\u5012\\u8ba1\\u65f6\\uff1a\"+this.state.time+\"\\u79d2\":\"\\u83b7\\u53d6\\u9a8c\\u8bc1\\u7801\"})]}),Object(h[\"jsx\"])(l[\"s\"],{className:[\"message\",3===this.state.passwordError?\"\":\"correct\"].join(\",\"),children:this.inputError(this.state.codeError)})]}),Object(h[\"jsx\"])(l[\"s\"],{className:\"submit\",onClick:function(){return e.handOnUserInfo()},children:\"\\u70b9\\u51fb\\u6ce8\\u518c\"})]})}}]),s}(u[\"Component\"]),O=p,f={navigationBarTitleText:\"\\u6ce8\\u518c\\u4fe1\\u606f\"};Page(Object(a[\"createPageConfig\"])(O,\"pages/regist/regist\",{root:{cn:[]}},f||{}))},86:function(e,t,s){}},[[122,0,1,2]]]);","extractedComments":[]}