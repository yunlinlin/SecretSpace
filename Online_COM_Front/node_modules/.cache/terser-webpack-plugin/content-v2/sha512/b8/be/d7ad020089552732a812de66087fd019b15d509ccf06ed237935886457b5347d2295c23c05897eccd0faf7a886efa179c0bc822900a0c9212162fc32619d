{"code":"(wx[\"webpackJsonp\"]=wx[\"webpackJsonp\"]||[]).push([[44],{118:function(e,t,a){\"use strict\";a.r(t);var s=a(4),n=a(6),c=a(7),l=a(9),i=a(10),o=a(1),u=a(0),r=a(8),d=a(3),h=a.n(d),j=h.a.getApp(),m=[\"\\u6d3b\\u52a8\",\"\\u5f81\\u53cb\",\"\\u5e2e\\u5fd9\",\"\\u95ee\\u9898\\u54a8\\u8be2\"],f=[\"activity\",\"make_friend\",\"help\",\"QA\"];function p(e,t,a){for(var s=new Array,n=function(n){s.push(new Promise((function(s,c){h.a.uploadFile({url:j.config.api+\"/upload/imageAdd\",filePath:t[n].url,name:\"file\",formData:{title:a,className:f[e],num:n+1},header:{authorrization:\"Bearer \".concat(h.a.getStorageSync(\"USER\")),\"content-type\":\"application/x-www-form-urlencoded\",uid:\"\".concat(h.a.getStorageSync(\"UID\"))},success:function(e){500===e.statusCode?c(new Error(JSON.parse(e.data))):s(e)},fail:c})})))},c=0;c<t.length;c++)n(c);return s}a(96);var O=a(2),b=h.a.getApp(),x=\"\",g={},v=function(e){Object(l[\"a\"])(a,e);var t=Object(i[\"a\"])(a);function a(e){var s;return Object(n[\"a\"])(this,a),s=t.call(this,e),s.state={topicValue:\"\",timeValue:\"\",placeValue:\"\",contentValue:\"\",files:[],dateSelect:\"2000-01-01\",selectorChecked:-1},s}return Object(c[\"a\"])(a,[{key:\"componentWillReceiveProps\",value:function(e){console.log(this.props,e)}},{key:\"componentWillUnmount\",value:function(){}},{key:\"componentDidShow\",value:function(){}},{key:\"componentDidHide\",value:function(){}},{key:\"uploadClass\",value:function(e){this.setState({selectorChecked:parseInt(e.detail.value)})}},{key:\"handOnTopic\",value:function(e){this.setState({topicValue:e.detail.value})}},{key:\"handOnTime\",value:function(e){this.setState({timeValue:e.detail.value})}},{key:\"handOnPlace\",value:function(e){this.setState({placeValue:e.detail.value})}},{key:\"handOnContent\",value:function(e){this.setState({contentValue:e.detail.value})}},{key:\"handOnImage\",value:function(e){this.setState({files:e})}},{key:\"UploadActivity\",value:function(){var e=this,t=new Array,a=p(this.state.selectorChecked,this.state.files,this.state.topicValue);Promise.all(a).then((function(a){a.map((function(e){t.push(JSON.parse(e.data))}));var s=JSON.stringify(t),n=b.post.request(\"/activity/add\",\"POST\",{topicValue:e.state.topicValue,timeValue:e.state.timeValue,placeValue:e.state.placeValue,contentValue:e.state.contentValue,dateSelect:e.state.dateSelect,imageInfo:s,classify:f[e.state.selectorChecked]});n.then((function(t){if(console.log(t.data),500===t.statusCode)throw new Error(t.data);h.a.showToast({title:t.data,icon:\"success\",duration:2e3}).then((function(){setTimeout((function(){e.Back()}),2e3)}))}))})).catch((function(e){h.a.showToast({title:e.message,icon:\"error\",duration:2e3})}))}},{key:\"handOnDate\",value:function(e){this.setState({dateSelect:e.detail.value})}},{key:\"Back\",value:function(){var e=h.a.getCurrentPages(),t=e[e.length-2];t.onLoad(),h.a.navigateBack({delta:1})}},{key:\"uploadDetail\",value:function(){var e=this,t=new Array,a=p(this.state.selectorChecked,this.state.files,this.state.topicValue);Promise.all(a).then((function(a){a.map((function(e){t.push(JSON.parse(e.data))}));var s=JSON.stringify(t);0==e.state.selectorChecked?(x=\"/activity/add\",g={topicValue:e.state.topicValue,timeValue:e.state.timeValue,placeValue:e.state.placeValue,contentValue:e.state.contentValue,dateSelect:e.state.dateSelect,imageInfo:s,classify:f[e.state.selectorChecked]}):(x=\"/item/add\",g={topicValue:e.state.topicValue,contentValue:e.state.contentValue,imageInfo:s,classify:f[e.state.selectorChecked]});var n=b.post.request(x,\"POST\",g);n.then((function(t){if(console.log(t.data),500===t.statusCode)throw new Error(t.data);h.a.showToast({title:t.data,icon:\"success\",duration:2e3}).then((function(){setTimeout((function(){e.Back()}),2e3)}))}))})).catch((function(e){h.a.showToast({title:e.message,icon:\"error\",duration:2e3})}))}},{key:\"render\",value:function(){var e=this;return-1===this.state.selectorChecked?Object(O[\"jsx\"])(u[\"s\"],{className:\"container\",children:Object(O[\"jsx\"])(u[\"k\"],{mode:\"selector\",range:m,onChange:function(t){return e.uploadClass(t)},children:Object(O[\"jsx\"])(r[\"k\"],{children:Object(O[\"jsx\"])(r[\"l\"],{title:\"\\u8bf7\\u9009\\u62e9\\u9700\\u8981\\u4e0a\\u4f20\\u7684\\u7c7b\\u578b\",extraText:m[this.state.selectorChecked]})})})}):0===this.state.selectorChecked?Object(O[\"jsxs\"])(u[\"s\"],{className:\"container\",children:[Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u6d3b\\u52a8\\u4e3b\\u9898\"})]}),Object(O[\"jsx\"])(u[\"r\"],{className:\"content\",value:this.state.topicValue,onInput:function(t){return e.handOnTopic(t)},disableDefaultPadding:!0,autoHeight:!0,maxlength:30,placeholder:\"\\u60a8\\u7684\\u6d3b\\u52a8\\u4e3b\\u9898\\u662f...(\\u5efa\\u8bae15\\u5b57\\u4ee5\\u5185)\"}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u6d3b\\u52a8\\u65e5\\u671f\"})]}),Object(O[\"jsx\"])(u[\"s\"],{className:\"date-select\",children:Object(O[\"jsx\"])(u[\"k\"],{mode:\"date\",value:\"\",onChange:function(t){return e.handOnDate(t)},children:Object(O[\"jsx\"])(r[\"k\"],{children:Object(O[\"jsx\"])(r[\"l\"],{title:\"\\u8bf7\\u9009\\u62e9\\u65e5\\u671f\",extraText:this.state.dateSelect})})})}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u6d3b\\u52a8\\u65f6\\u95f4\\u6bb5\"})]}),Object(O[\"jsx\"])(u[\"r\"],{className:\"content\",value:this.state.timeValue,onInput:function(t){return e.handOnTime(t)},disableDefaultPadding:!0,autoHeight:!0,maxlength:15,placeholder:\"\\u4f8b: 9:00~18:00\"}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u6d3b\\u52a8\\u5730\\u70b9\"})]}),Object(O[\"jsx\"])(u[\"r\"],{className:\"content\",value:this.state.placeValue,onInput:function(t){return e.handOnPlace(t)},disableDefaultPadding:!0,autoHeight:!0,maxlength:50,placeholder:\"\\u60a8\\u7684\\u6d3b\\u52a8\\u5730\\u70b9\\u662f...\"}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u6d3b\\u52a8\\u5185\\u5bb9\\u7b80\\u4ecb\"})]}),Object(O[\"jsx\"])(u[\"r\"],{className:\"content\",value:this.state.contentValue,onInput:function(t){return e.handOnContent(t)},disableDefaultPadding:!0,autoHeight:!0,maxlength:600,placeholder:\"\\u60a8\\u7684\\u6d3b\\u52a8\\u5185\\u5bb9\\u662f...(500\\u5b57\\u4ee5\\u5185)\"}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u56fe\\u7247\\u4fe1\\u606f\\uff08\\u7b2c\\u4e00\\u5f20\\u4f5c\\u4e3a\\u5c55\\u677f\\uff09\"})]}),Object(O[\"jsx\"])(r[\"j\"],{files:this.state.files,onChange:function(t){return e.handOnImage(t)}}),Object(O[\"jsx\"])(u[\"s\"],{className:\"submit\",onClick:function(){return e.uploadDetail()},children:Object(O[\"jsx\"])(u[\"q\"],{children:\"\\u63d0\\u4ea4\"})}),Object(O[\"jsx\"])(u[\"s\"],{className:\"gap\"})]}):Object(O[\"jsxs\"])(u[\"s\"],{className:\"container\",children:[Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u5185\\u5bb9\\u4e3b\\u9898\"})]}),Object(O[\"jsx\"])(u[\"r\"],{className:\"content\",value:this.state.topicValue,onInput:function(t){return e.handOnTopic(t)},disableDefaultPadding:!0,autoHeight:!0,maxlength:30,placeholder:\"\\u60a8\\u7684\\u6d3b\\u52a8\\u4e3b\\u9898\\u662f...(\\u5efa\\u8bae15\\u5b57\\u4ee5\\u5185)\"}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u5185\\u5bb9\\u8bf4\\u660e\"})]}),Object(O[\"jsx\"])(u[\"r\"],{className:\"content\",value:this.state.contentValue,onInput:function(t){return e.handOnContent(t)},disableDefaultPadding:!0,autoHeight:!0,maxlength:600,placeholder:\"\\u60a8\\u7684\\u5177\\u4f53\\u5185\\u5bb9\\u662f...(500\\u5b57\\u4ee5\\u5185)\"}),Object(O[\"jsxs\"])(u[\"s\"],{className:\"title\",children:[Object(O[\"jsx\"])(u[\"s\"],{className:\"title-dot\"}),Object(O[\"jsx\"])(u[\"q\"],{className:\"act-title\",children:\"\\u56fe\\u7247\\u4fe1\\u606f\\uff08\\u7b2c\\u4e00\\u5f20\\u4f5c\\u4e3a\\u5c55\\u677f\\uff09\"})]}),Object(O[\"jsx\"])(r[\"j\"],{files:this.state.files,onChange:function(t){return e.handOnImage(t)}}),Object(O[\"jsx\"])(u[\"s\"],{className:\"submit\",onClick:function(){return e.uploadDetail()},children:Object(O[\"jsx\"])(u[\"q\"],{children:\"\\u63d0\\u4ea4\"})})]})}}]),a}(o[\"Component\"]),N=v,k={navigationBarTitleText:\"\\u4e0a\\u4f20\\u5185\\u5bb9\"};Page(Object(s[\"createPageConfig\"])(N,\"pages/upload/upload\",{root:{cn:[]}},k||{}))},96:function(e,t,a){}},[[118,0,1,2]]]);","extractedComments":[]}